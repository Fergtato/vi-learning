<!DOCTYPE html>
<html lang="en">

<head>
    <title>Visual Learning</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//davidshimjs.github.com/qrcodejs/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>
    <script src="//threejs.org/build/three.min.js"></script>
    <script src="js/controls/OrbitControls.js"></script>

    <!--     <script src="sketch.js" type="text/javascript"></script> -->

    <style>
        body {
            margin: 0;
        }

        #qr {
            position: absolute;
            top: 0;
            padding: 20px;
            background: white;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
</body>

<script>
    var io = io.connect();

    io.on('connect', function() {

        io.emit('game_connect');

        var qr = document.createElement('div');
        qr.id = "qr";
        document.body.appendChild(qr);

        var game_connected = function() {
            var url = "http://192.168.105.99:8080/controller.html?id=" + io.id;
            // document.body.innerHTML += url;
            console.log(url);
            var qr_code = new QRCode("qr");
            qr_code.makeCode(url);
            io.removeListener('game_connected', game_connected);
        };


        // THREE JS CODE

        var camera,
            scene,
            renderer,
            controls;
        var sun,
            mercury, mercuryPivot,
            venus, venusPivot,
            earth, earthPivot,
            moon, moonPivot,
            mars, marsPivot,
            jupiter, jupiterPivot,
            saturn, saturnPivot,
            saturnsRings, saturnsRingsPivot,
            uranus, uranusPivot,
            neptune, neptunePivot,
            pluto, plutoPivot;
        // var spin = 0;
        // var yRotationValue = 0;
        // const axis = new THREE.Vector3(0, 1, 0).normalize();
        // var quaternion = new THREE.Quaternion();

        init();
        animate();

        function init() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
            controls = new THREE.OrbitControls( camera );
            camera.position.set(0, 2, 50);
            controls.update();
            // camera.lookAt(scene.position);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            var material = new THREE.MeshNormalMaterial();

            var loader = new THREE.TextureLoader();


            // loader.load('earth.jpg', function(texture) {
            //     var earthGeometry = new THREE.SphereGeometry(0.3, 32, 32);
            //     var earthMaterial = new THREE.MeshBasicMaterial({
            //         map: texture
            //     })
            //     earth = new THREE.Mesh(earthGeometry, earthMaterial);
            //     scene.add(earth);
            //     earth.translateX(3);
            // });

            //
            // SUN
            //

            var sunGeometry = new THREE.SphereGeometry(10, 32, 32);
            var sunTexture = loader.load( 'sun.jpg' );
            var sunMaterial = new THREE.MeshBasicMaterial( { map: sunTexture } );
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            scene.add(sun);

            //
            // MERCURY
            //

            mercuryPivot = new THREE.Object3D();
            sun.add( mercuryPivot );

            var mercuryGeometry = new THREE.SphereGeometry(2, 32, 32);
            var mercuryTexture = loader.load( 'mercury.jpg' );
        	var mercuryMaterial = new THREE.MeshLambertMaterial( { map: mercuryTexture } );
        	mercury = new THREE.Mesh(mercuryGeometry, mercuryMaterial);
            mercury.position.x = 20;
            mercuryPivot.add(mercury);

            //
            // VENUS
            //

            venusPivot = new THREE.Object3D();
            sun.add( venusPivot );

            var venusGeometry = new THREE.SphereGeometry(2, 32, 32);
            var venusTexture = loader.load( 'venus.jpg' );
        	var venusMaterial = new THREE.MeshLambertMaterial( { map: venusTexture } );
        	venus = new THREE.Mesh(venusGeometry, venusMaterial);
            venus.position.x = 30;
            venusPivot.add(venus);

            //
            // EARTH
            //

            earthPivot = new THREE.Object3D();
            sun.add( earthPivot );

            var earthGeometry = new THREE.SphereGeometry(3, 64, 64);
            var earthTexture = loader.load( 'earth.jpg' );
        	var earthMaterial = new THREE.MeshLambertMaterial( { map: earthTexture } );
        	earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.position.x = 40;
            earthPivot.add(earth);

            //
            // MOON
            //

            moonPivot = new THREE.Object3D();
            earth.add( moonPivot );

            var moonGeometry = new THREE.SphereGeometry(0.7, 32, 32);
            var moonTexture = loader.load( 'moon.jpg' );
        	var moonMaterial = new THREE.MeshLambertMaterial( { map: moonTexture } );
        	moon = new THREE.Mesh(moonGeometry, moonMaterial);
            moon.position.x = 5;
            moonPivot.add(moon);

            //
            // MARS
            //

            marsPivot = new THREE.Object3D();
            sun.add( marsPivot );

            var marsGeometry = new THREE.SphereGeometry(1.5, 32, 32);
            var marsTexture = loader.load( 'mars.jpg' );
        	var marsMaterial = new THREE.MeshLambertMaterial( { map: marsTexture } );
        	mars = new THREE.Mesh(marsGeometry, marsMaterial);
            mars.position.x = 50;
            marsPivot.add(mars);

            //
            // JUPITER
            //

            jupiterPivot = new THREE.Object3D();
            sun.add( jupiterPivot );

            var jupiterGeometry = new THREE.SphereGeometry(5, 32, 32);
            var jupiterTexture = loader.load( 'jupiter.jpg' );
        	var jupiterMaterial = new THREE.MeshLambertMaterial( { map: jupiterTexture } );
        	jupiter = new THREE.Mesh(jupiterGeometry, jupiterMaterial);
            jupiter.position.x = 60;
            jupiterPivot.add(jupiter);

            //
            // SATURN
            //

            saturnPivot = new THREE.Object3D();
            sun.add( saturnPivot );

            var saturnGeometry = new THREE.SphereGeometry(4, 32, 32);
            var saturnTexture = loader.load( 'saturn.jpg' );
        	var saturnMaterial = new THREE.MeshLambertMaterial( { map: saturnTexture } );
        	saturn = new THREE.Mesh(saturnGeometry, saturnMaterial);
            saturn.position.x = 70;
            saturnPivot.add(saturn);

            saturnsRingsPivot = new THREE.Object3D();
            saturn.add( saturnsRingsPivot );

            var saturnsRingsGeometry = new THREE.CircleGeometry( 9, 32 );
            var saturnsRingsTexture = loader.load( 'saturn_ring_alpha.png' );
            var saturnsRingsMaterial = new THREE.MeshLambertMaterial( { map: saturnsRingsTexture,
            side: THREE.DoubleSide } );
            saturnsRings = new THREE.Mesh( saturnsRingsGeometry, saturnsRingsMaterial );
            saturnsRings.rotation.x = 5;
            saturnsRingsPivot.add( saturnsRings );

            //
            // URANUS
            //

            uranusPivot = new THREE.Object3D();
            sun.add( uranusPivot );

            var uranusGeometry = new THREE.SphereGeometry(3, 32, 32);
            var uranusTexture = loader.load( 'uranus.jpg' );
        	var uranusMaterial = new THREE.MeshLambertMaterial( { map: uranusTexture } );
        	uranus = new THREE.Mesh(uranusGeometry, uranusMaterial);
            uranus.position.x = 80;
            uranusPivot.add(uranus);

            //
            // NEPTUNE
            //

            neptunePivot = new THREE.Object3D();
            sun.add( neptunePivot );

            var neptuneGeometry = new THREE.SphereGeometry(3, 32, 32);
            var neptuneTexture = loader.load( 'neptune.jpg' );
        	var neptuneMaterial = new THREE.MeshLambertMaterial( { map: neptuneTexture } );
        	neptune = new THREE.Mesh(neptuneGeometry, neptuneMaterial);
            neptune.position.x = 90;
            neptunePivot.add(neptune);

            //
            // PLUTO
            //

            plutoPivot = new THREE.Object3D();
            sun.add( plutoPivot );

            var plutoGeometry = new THREE.SphereGeometry(1, 32, 32);
            var plutoTexture = loader.load( 'pluto.jpg' );
        	var plutoMaterial = new THREE.MeshLambertMaterial( { map: plutoTexture } );
        	pluto = new THREE.Mesh(plutoGeometry, plutoMaterial);
            pluto.position.x = 100;
            plutoPivot.add(pluto);



            loader.load('stars_milky_way.jpg', function(texture) {
                var sphereGeometry = new THREE.SphereGeometry(500, 60, 40)
                var sphereMaterial = new THREE.MeshBasicMaterial({
                    map: texture,
                    side: THREE.DoubleSide
                })
                sphereGeometry.scale(-1, 1, 1);
                var mesh = new THREE.Mesh(sphereGeometry, sphereMaterial);
                scene.add(mesh);
                mesh.position.set(0, 0, 0)
            });

            rings();

            var light = new THREE.PointLight( 0xffffff, 2, 400 );
            light.position.set( 0, 0, 0 );
            scene.add( light );

            var ambientLight = new THREE.AmbientLight( 0x303030 ); // soft white light
            scene.add( ambientLight );

            document.addEventListener('keydown', Keyboard, false);
        }

        function Keyboard() {
            if(event.keyCode == 68) {
                console.log(earth.position);
                controls.target.set(earth.position.x,earth.position.y,earth.position.z);
            }
        }

        function rings() {
            var ringMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff } );

            for (i = 0; i < 9; i++) {
                var ringgeom = new THREE.TorusGeometry( (i+2)*10, 0.1, 16, 100 );
                var ring = new THREE.Mesh( ringgeom, ringMaterial );
                ring.rotation.x = Math.PI / 2;
                scene.add( ring );
            }

        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            mercury.rotateY(-0.003);
            venus.rotateY(-0.003);
            earth.rotateY(-0.003);
            moon.rotateY(-0.003);
            mars.rotateY(-0.003);
            jupiter.rotateY(-0.003);
            saturn.rotateY(-0.003);
            uranus.rotateY(-0.003);
            neptune.rotateY(-0.003);
            pluto.rotateY(-0.003);

            mercuryPivot.rotation.y += 0.0047;
            venusPivot.rotation.y += 0.0035;
            earthPivot.rotation.y += 0.0029;
            moonPivot.rotation.y += 0.01;
            marsPivot.rotation.y += 0.0024;
            jupiterPivot.rotation.y += 0.002;
            saturnPivot.rotation.y += 0.0014;
            uranusPivot.rotation.y += 0.0022;
            neptunePivot.rotation.y += 0.001;
            plutoPivot.rotation.y += 0.0013;


            // quaternion.setFromAxisAngle(axis, 0.005);
            // earth.position.applyQuaternion(quaternion);
            // mars.position.applyQuaternion(quaternion);

            // spin += 0.001;
            //
            // camera.position.x = Math.cos(spin) * 5;
            // camera.position.z = Math.sin(spin) * 5;
            // camera.position.y = yRotationValue;
            //
            // camera.lookAt(scene.position);

            // controls.rotateLeft(Math.PI/500);
            // controls.rotateUp(Math.PI/500);


            // controls.target.set(saturn.position.x,saturn.position.y,saturn.position.z);

            controls.update();

            renderer.render(scene, camera);
        };

        io.on('game_connected', game_connected);

        io.on('controller_connected', function(connected) {
            if (connected) {
                document.getElementById("qr").style.display = "none";
            } else {
                document.getElementById("qr").style.display = "block";
            }
        });

        io.on('clicked', function(message) {
            // spin += message;
            controls.rotateX((Math.PI/50)*message);
            // console.log(message);
        });

        io.on('yRotating', function(yRotation) {
            controls.rotateY((Math.PI/50)*yRotation);
        });



    });
</script>

</html>
