<!DOCTYPE html>
<html lang="en">

<head>
    <title>Visual Learning</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//davidshimjs.github.com/qrcodejs/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.2/p5.js"></script>

<!--     <script src="sketch.js" type="text/javascript"></script> -->

    <style>
        canvas {
            /* display: none; */
        }
    </style>
</head>

<body>
</body>

<script>
    var io = io.connect();

    io.on('connect', function() {

        if (window.location.href.indexOf('?id=') > 0) {

            io.emit('controller_connect', window.location.href.split('?id=')[1]);

            io.on('controller_connected', function(connected) {
                if (connected) {
                    alert("Connected");
                    // document.getElementById('defaultCanvas0').style.display = 'block';
                    function setup() {
                        createCanvas(720,720);
                        rectMode(CENTER);
                    }

                    function draw() {
                        background(0);
                        fill(255,255,0);
                        rect(mouseX,mouseY,100,100);
                    }
                } else {
                    alert("Not Connected");
                }

            });

        } else {

            io.emit('game_connect');

            // var canvas = document.getElementById('defaultCanvas0');
            // canvas.style.display = 'none';
            // document.getElementById('defaultCanvas0').className='hide-me';

            var qr = document.createElement('div');
            qr.id = "qr";
            document.body.appendChild(qr);

            var game_connected = function() {
                var url = "http://192.168.1.8:8080?id=" + io.id;
                document.body.innerHTML += url;
                var qr_code = new QRCode("qr");
                qr_code.makeCode(url);
                io.removeListener('game_connected', game_connected);
            };

            io.on('game_connected', game_connected);

            io.on('controller_connected', function(connected) {
                if (connected) {
                    qr.style.display = "none";
                } else {
                    qr.style.display = "block";
                }
            });

        }

    });
</script>

</html>
